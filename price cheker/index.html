<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор цены со скидкой</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 30px;
      max-width: 600px;
      margin: auto;
      background-color: #f9f9f9;
    }
    input, button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      font-size: 16px;
    }
    #output {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      white-space: pre-line;
    }
  </style>
</head>
<body>

<h2>Калькулятор со скидкой 15%</h2>
<input type="text" id="url" placeholder="Вставьте ссылку на vostok.ru">
<button onclick="fetchPrice()">Рассчитать</button>
<div id="output"></div>

<script>
  async function fetchPrice() {
    const url = document.getElementById("url").value.trim();
    if (!url.startsWith("https://vostok.ru")) {
      document.getElementById("output").innerText = "Только ссылки на vostok.ru поддерживаются.";
      return;
    }

    try {
      const apiUrl = "/.netlify/functions/get-price?url=" + encodeURIComponent(url);
      const res = await fetch(apiUrl);
      const data = await res.json();

      if (data.error) {
        document.getElementById("output").innerText = "Ошибка: " + data.error;
        return;
      }

      const price = parseFloat(data.price);
      const discounted = price * 0.85;

      document.getElementById("output").innerText =
        "Оригинальная цена: ${price.toFixed(2)} ₽\nСо скидкой 15%: ${discounted.toFixed(2)} ₽";
    } catch (e) {
      document.getElementById("output").innerText = "Ошибка при загрузке.";
    }
  }
</script>

</body>
</html>